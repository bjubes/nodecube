<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	var size = 50;
	var ctx = document.getElementById("ctx").getContext("2d");
	ctx.font = '30px Arial';

	var socket = io();
	//collection of {id: color}
	var playerList = {}

	socket.on('newPositions',function(data){
		ctx.clearRect(0,0,500,500);
		for(var i = 0 ; i < data.length; i++) {
			var player = data[i];
			ctx.fillRect(player.x - size/2, player.y - size/2, size, size);
			//color logic
		 	if (player.id in playerList) {
				ctx.fillStyle = playerList[player.id].color;
			} else
			{
				//actually populating the list is dealt with by colorOfPlayerResponse
				socket.emit('colorOfPlayer', player.id);
				//set it to undefined so we don't query server multiple times
				playerList[player.id] = {color:"#000000"};
			}
		}


	});

	socket.on('colorOfPlayerResponse', function(player){
		playerList[player.id].color = player.color;
	})

	socket.on('playerDisconnect', function(data){
		delete playerList[data.id];
	})


</script>
